<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Orga_route &mdash; Event-Assignement 2023 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Event-Assignement
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">src</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Event-Assignement</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Module code</a></li>
      <li class="breadcrumb-item active">Orga_route</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for Orga_route</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">flask_bcrypt</span> <span class="kn">import</span> <span class="n">generate_password_hash</span><span class="p">,</span> <span class="n">check_password_hash</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">flash</span><span class="p">,</span> <span class="n">get_flashed_messages</span><span class="p">,</span> <span class="n">session</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">url_for</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">Blueprint</span>
<span class="kn">from</span> <span class="nn">peewee</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>

<span class="kn">from</span> <span class="nn">profil</span> <span class="kn">import</span> <span class="n">db</span><span class="p">,</span> <span class="n">Guest</span><span class="p">,</span> <span class="n">Player</span><span class="p">,</span> <span class="n">Orga</span><span class="p">,</span> <span class="n">Tables</span>
<span class="kn">from</span> <span class="nn">form</span> <span class="kn">import</span> <span class="n">orga_login</span><span class="p">,</span> <span class="n">orga_register</span><span class="p">,</span> <span class="n">ExchangeSeats</span>
<span class="kn">from</span> <span class="nn">send_email</span> <span class="kn">import</span> <span class="o">*</span>


<div class="viewcode-block" id="orga_login_required_id"><a class="viewcode-back" href="../Orga_route.html#Orga_route.orga_login_required_id">[docs]</a><span class="k">def</span> <span class="nf">orga_login_required_id</span><span class="p">(</span><span class="n">ident</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This wrap function restrain certain pages only to user that are connected as organizers</span>
<span class="sd">   </span>
<span class="sd">    :param ident: id of the user</span>
<span class="sd">    :type ident: int</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">orga_login_required</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
        <span class="nd">@wraps</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">decorated_function</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="s1">&#39;orga&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ident</span><span class="p">))</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">session</span><span class="p">:</span>
                <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;Vous devez être enregistré en tant qu&#39;organisateur si vous souhaitez accéder à cette page&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;orga.log_orga&#39;</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">decorated_function</span>
    <span class="k">return</span> <span class="n">orga_login_required</span></div>



<span class="n">db</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
<span class="n">db</span><span class="o">.</span><span class="n">create_tables</span><span class="p">([</span><span class="n">Guest</span><span class="p">,</span> <span class="n">Player</span><span class="p">,</span> <span class="n">Orga</span><span class="p">,</span> <span class="n">Tables</span><span class="p">])</span>

<span class="n">bp</span> <span class="o">=</span> <span class="n">Blueprint</span><span class="p">(</span><span class="s1">&#39;orga&#39;</span><span class="p">,</span> <span class="vm">__name__</span><span class="p">)</span>

<span class="c1"># Connexion de l&#39;organisateur s&#39;il s&#39;est déjà connecté</span>
<div class="viewcode-block" id="log_orga"><a class="viewcode-back" href="../Orga_route.html#Orga_route.log_orga">[docs]</a><span class="nd">@bp</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/orga.log_orga&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;get&#39;</span><span class="p">,</span> <span class="s1">&#39;post&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">log_orga</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function &#39;log_orga&#39; handles the back-end of &#39;orga_log.html&#39; page. If a user fills correct informations, </span>
<span class="sd">    an email that is in the Database and the correct password, then he can go to the Page de Garde for the organizers.</span>

<span class="sd">    :return: Log Orga page or Page de Garde page</span>
<span class="sd">    :rtype: template</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">form</span> <span class="o">=</span> <span class="n">orga_login</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">validate_on_submit</span><span class="p">():</span>
            <span class="n">orga</span> <span class="o">=</span> <span class="n">Orga</span><span class="o">.</span><span class="n">get_orga_mail</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">mariage</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">form</span><span class="o">.</span><span class="n">email</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="c1"># trying to get the organizer</span>
            <span class="k">if</span> <span class="n">orga</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span>
                <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;Mariage ou email introuvable&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;orga.log_orga&#39;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">check_password_hash</span><span class="p">(</span><span class="n">orga</span><span class="o">.</span><span class="n">password</span><span class="p">,</span> <span class="n">form</span><span class="o">.</span><span class="n">password</span><span class="o">.</span><span class="n">data</span><span class="p">):</span>
                    <span class="n">ident</span> <span class="o">=</span> <span class="n">orga</span><span class="o">.</span><span class="n">id</span> <span class="c1">#getting the identifier</span>
                    <span class="c1">#effectuer la connexion avec le serveur : </span>
                    <span class="n">session</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;orga&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ident</span><span class="p">))]</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;page_de_garde_login&#39;</span><span class="p">,</span> <span class="n">statut</span><span class="o">=</span><span class="s1">&#39;orga&#39;</span><span class="p">,</span> <span class="n">ident</span><span class="o">=</span><span class="n">ident</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span> 
                    <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;Mot de passe incorrect&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;orga.log_orga&#39;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;Veuillez entrer un mail correct&quot;</span><span class="p">)</span> <span class="c1"># Email error</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;orga.log_orga&#39;</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span> 
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;orga_log.html&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Orga login&quot;</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">,</span> <span class="n">messages</span> <span class="o">=</span> <span class="n">get_flashed_messages</span><span class="p">())</span></div>

<span class="c1">#Page de première connexion de l&#39;organisateur : création de son compte </span>
<span class="c1"># avec création de son mot de passe + nom du mariage</span>
<div class="viewcode-block" id="orga_reg"><a class="viewcode-back" href="../Orga_route.html#Orga_route.orga_reg">[docs]</a><span class="nd">@bp</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/orga_register&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;get&#39;</span><span class="p">,</span><span class="s1">&#39;post&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">orga_reg</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function &#39;orga_reg&#39; handles the back-end of &#39;orga_register.html&#39; page, meaning the page where a user</span>
<span class="sd">     can register himself. If a user fills correct informations asked by the form, then he can go to the Page de Garde </span>
<span class="sd">     for organizers.</span>

<span class="sd">    :return: Orga Register page or Page de Garde page</span>
<span class="sd">    :rtype: template</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">orga_register</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">validate_on_submit</span><span class="p">():</span>
            <span class="n">mariage</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">mariage</span><span class="o">.</span><span class="n">data</span>
            <span class="n">email</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">email</span><span class="o">.</span><span class="n">data</span>
            <span class="n">organizer</span> <span class="o">=</span> <span class="n">Orga</span><span class="o">.</span><span class="n">get_orga_mail</span><span class="p">(</span><span class="n">mariage</span><span class="p">,</span> <span class="n">email</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">organizer</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;Vous êtes déjà enregistré pour l&#39;organisation de ce mariage, veuillez vous identifier&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;orga.log_orga&#39;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">hashed_password</span> <span class="o">=</span> <span class="n">generate_password_hash</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">password</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
                <span class="n">orga</span> <span class="o">=</span> <span class="n">Orga</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
                        <span class="n">email</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">email</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> 
                        <span class="n">password</span> <span class="o">=</span> <span class="n">hashed_password</span><span class="p">,</span>
                        <span class="n">mariage</span> <span class="o">=</span> <span class="n">mariage</span><span class="p">,</span>
                        <span class="n">name</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                        <span class="n">surname</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">surname</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                        <span class="n">groom_name</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">groom_name</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> 
                        <span class="n">groom_surname</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">groom_surname</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                        <span class="n">bride_name</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">bride_name</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                        <span class="n">bride_surname</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">bride_surname</span><span class="o">.</span><span class="n">data</span>
                    <span class="p">)</span>
                <span class="n">orga</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

                <span class="c1">#connecting to the server</span>
                <span class="n">session</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;orga&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">orga</span><span class="o">.</span><span class="n">id</span><span class="p">))]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;page_de_garde_login&#39;</span><span class="p">,</span> <span class="n">statut</span><span class="o">=</span><span class="s1">&#39;orga&#39;</span><span class="p">,</span> <span class="n">ident</span><span class="o">=</span><span class="n">orga</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;Veuillez entrer un mail correct svp&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;orga.orga_reg&#39;</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;orga_register.html&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Orga register&quot;</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">,</span> <span class="n">messages</span><span class="o">=</span><span class="n">get_flashed_messages</span><span class="p">())</span></div>



<span class="c1"># Affichage de la liste des invités : nom / prénom / participation ou non de l&#39;invité</span>
<span class="c1"># avec la possibilité, lorsque l&#39;invité s&#39;est enregistrer, de voir son profil</span>
<span class="c1"># + possibilité de générer un plan de tables avec les invités ayant déjà répondu au formulaire </span>
<div class="viewcode-block" id="guest_list"><a class="viewcode-back" href="../Orga_route.html#Orga_route.guest_list">[docs]</a><span class="nd">@bp</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/guest_list/&lt;statut&gt;/&lt;mariage&gt;/&lt;ident&gt;&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">guest_list</span><span class="p">(</span><span class="n">statut</span><span class="p">,</span><span class="n">mariage</span><span class="p">,</span> <span class="n">ident</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The function &#39;guest_list&#39; handles the back-end of &#39;orga_guest_list&#39; page, meaning the page where an organizer can see the list of the Guests for his wedding. The organizer can also see the answer of the Gest and their informations.</span>

<span class="sd">    :param statut: statut of the user</span>
<span class="sd">    :type statut: str</span>
<span class="sd">    :param mariage: name of the mariage of the guest accessing to its personal profile</span>
<span class="sd">    :type mariage: str</span>
<span class="sd">    :param ident: id of the user</span>
<span class="sd">    :type ident: int</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@orga_login_required_id</span><span class="p">(</span><span class="n">ident</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">():</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">Guest</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Guest</span><span class="o">.</span><span class="n">mariage</span> <span class="o">==</span> <span class="n">mariage</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">Guest</span><span class="o">.</span><span class="n">surname</span><span class="p">)</span>
        <span class="n">nb_player</span> <span class="o">=</span> <span class="n">Player</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Player</span><span class="o">.</span><span class="n">mariage</span><span class="o">==</span><span class="n">mariage</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
        <span class="n">nb_guest</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;orga_guest_list.html&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;guest_list&quot;</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="n">query</span><span class="p">,</span> <span class="n">Player</span> <span class="o">=</span> <span class="n">Player</span><span class="p">,</span> <span class="n">statut</span><span class="o">=</span><span class="n">statut</span><span class="p">,</span> <span class="n">ident</span><span class="o">=</span><span class="n">ident</span><span class="p">,</span> <span class="n">mariage</span><span class="o">=</span><span class="n">mariage</span><span class="p">,</span> <span class="n">nb_player</span><span class="o">=</span><span class="n">nb_player</span><span class="p">,</span> <span class="n">nb_guest</span><span class="o">=</span><span class="n">nb_guest</span><span class="p">,</span> <span class="n">messages</span><span class="o">=</span><span class="n">get_flashed_messages</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">wrapper</span><span class="p">()</span></div>

<span class="c1"># Lien qui permet à l&#39;organisateur d&#39;écrire un mail et de l&#39;envoyer aux invités</span>
<div class="viewcode-block" id="send_email"><a class="viewcode-back" href="../Orga_route.html#Orga_route.send_email">[docs]</a><span class="nd">@bp</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/send_email/&lt;statut&gt;/&lt;mariage&gt;/&lt;ident&gt;&#39;</span><span class="p">,</span><span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;get&#39;</span><span class="p">,</span> <span class="s1">&#39;post&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">send_email</span><span class="p">(</span><span class="n">statut</span><span class="p">,</span><span class="n">mariage</span><span class="p">,</span> <span class="n">ident</span><span class="p">):</span>
    
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The function &#39;send_email&#39; handles the back-end of &#39;orga_send_email.html&#39; page, meaning the page where an organizer can send the invitation of his wedding to the Guests. The organizer has the opportunity to write the subject and the body of the email.</span>

<span class="sd">    :param statut: </span>
<span class="sd">    :type statut: </span>
<span class="sd">    :param mariage: The mariage to wconcerned by the inv</span>
<span class="sd">    :type mariage: StringField</span>
<span class="sd">    :param ident: </span>
<span class="sd">    :type ident: </span>
<span class="sd">    :return: </span>
<span class="sd">    :rtype: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@orga_login_required_id</span><span class="p">(</span><span class="n">ident</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
            <span class="n">subject</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">]</span>
            <span class="n">body</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;body&#39;</span><span class="p">]</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">Guest</span><span class="o">.</span><span class="n">select</span><span class="p">()</span>
            <span class="n">context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">create_default_context</span><span class="p">()</span>
            <span class="n">communication_list</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">guest</span> <span class="ow">in</span> <span class="n">query</span><span class="p">:</span>
                <span class="n">communication_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">guest</span><span class="o">.</span><span class="n">email</span><span class="p">)</span>
            <span class="n">send_mail_organisation</span><span class="p">(</span><span class="n">body</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span><span class="n">communication_list</span><span class="o">=</span><span class="n">communication_list</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;page_de_garde_login&#39;</span><span class="p">,</span> <span class="n">statut</span><span class="o">=</span><span class="n">statut</span><span class="p">,</span> <span class="n">ident</span><span class="o">=</span><span class="n">ident</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;orga_send_email.html&#39;</span><span class="p">,</span> <span class="n">mariage</span><span class="o">=</span><span class="n">mariage</span><span class="p">,</span> <span class="n">statut</span><span class="o">=</span><span class="n">statut</span><span class="p">,</span> <span class="n">ident</span><span class="o">=</span><span class="n">ident</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wrapper</span><span class="p">()</span></div>

<div class="viewcode-block" id="seating_plan"><a class="viewcode-back" href="../Orga_route.html#Orga_route.seating_plan">[docs]</a><span class="nd">@bp</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/seating_plan/&lt;statut&gt;/&lt;mariage&gt;/&lt;ident&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;get&#39;</span><span class="p">,</span> <span class="s1">&#39;post&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">seating_plan</span><span class="p">(</span><span class="n">statut</span><span class="p">,</span> <span class="n">mariage</span><span class="p">,</span> <span class="n">ident</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The function &#39;seating&#39; handles the back-end of &#39;orga_table_assigment.html&#39; page, meaning the page where </span>
<span class="sd">    an organizer can see the seating plan. The organizer has the opportunity to exchange people on the seating plan.</span>

<span class="sd">    :param statut: statut of the user</span>
<span class="sd">    :type statut: str</span>
<span class="sd">    :param mariage: name of the mariage of the guest accessing to its personal profile</span>
<span class="sd">    :type mariage: str</span>
<span class="sd">    :param ident: id of the user</span>
<span class="sd">    :type ident: int</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@orga_login_required_id</span><span class="p">(</span><span class="n">ident</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">():</span>
        <span class="n">seating_plan_bool</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">table_assignement</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">nb_people_side_fav</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">nb_couple_side_by_side</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># try:</span>
        <span class="c1">#     query = Player.select().where((Player.mariage == mariage) &amp; (Player.table.is_null()==False))</span>
        <span class="c1"># except DoesNotExist:</span>
        <span class="c1">#     #seating_plan_bool = False</span>
        
        <span class="n">query</span> <span class="o">=</span> <span class="n">Player</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">Player</span><span class="o">.</span><span class="n">mariage</span> <span class="o">==</span> <span class="n">mariage</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Player</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">is_null</span><span class="p">()</span><span class="o">==</span><span class="kc">False</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">query</span> <span class="p">:</span>
            <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;orga_table_assigment.html&quot;</span><span class="p">,</span> <span class="n">statut</span><span class="o">=</span><span class="n">statut</span><span class="p">,</span> <span class="n">ident</span><span class="o">=</span><span class="n">ident</span><span class="p">,</span> <span class="n">mariage</span><span class="o">=</span><span class="n">mariage</span><span class="p">,</span> <span class="n">table_assignement</span><span class="o">=</span><span class="n">table_assignement</span><span class="p">,</span><span class="n">seating_plan_bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">nb_table</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">nb_guest</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">player</span> <span class="ow">in</span> <span class="n">query</span><span class="p">:</span>
                <span class="n">table_assignement</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">player</span><span class="o">.</span><span class="n">color</span><span class="p">(),</span><span class="n">player</span><span class="o">.</span><span class="n">table</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">player</span><span class="o">.</span><span class="n">same_table</span><span class="p">(</span><span class="n">player</span><span class="o">.</span><span class="n">favorite_guest_1</span><span class="p">):</span>
                    <span class="n">nb_people_side_fav</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">player</span><span class="o">.</span><span class="n">same_table</span><span class="p">(</span><span class="n">player</span><span class="o">.</span><span class="n">favorite_guest_2</span><span class="p">):</span>
                    <span class="n">nb_people_side_fav</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">player</span><span class="o">.</span><span class="n">same_table</span><span class="p">(</span><span class="n">player</span><span class="o">.</span><span class="n">favorite_guest_3</span><span class="p">):</span>
                    <span class="n">nb_people_side_fav</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                
            <span class="n">nb_guest</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">table_assignement</span><span class="p">)</span>
            
            <span class="n">nb_table</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">Tables</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Tables</span><span class="o">.</span><span class="n">mariage</span> <span class="o">==</span> <span class="n">mariage</span><span class="p">):</span>
                <span class="n">nb_table</span> <span class="o">+=</span> <span class="n">table</span><span class="o">.</span><span class="n">number</span>
            
            <span class="n">nb_couple_side_by_side</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">couple</span> <span class="o">=</span> <span class="n">Player</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">Player</span><span class="o">.</span><span class="n">mariage</span> <span class="o">==</span> <span class="n">mariage</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Player</span><span class="o">.</span><span class="n">couple_situation</span> <span class="o">==</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">nb_couple</span> <span class="o">=</span> <span class="n">couple</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">player</span> <span class="ow">in</span> <span class="n">couple</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">player</span><span class="o">.</span><span class="n">same_table</span><span class="p">(</span><span class="n">player</span><span class="o">.</span><span class="n">partner_name</span><span class="p">):</span>
                    <span class="n">nb_couple_side_by_side</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">form</span> <span class="o">=</span> <span class="n">ExchangeSeats</span><span class="p">(</span><span class="n">mariage</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">validate_on_submit</span><span class="p">():</span>
                    <span class="n">id_1</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">player_1</span><span class="o">.</span><span class="n">data</span>
                    <span class="n">id_2</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">player_2</span><span class="o">.</span><span class="n">data</span>
                    <span class="k">if</span> <span class="n">id_1</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">id_2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;Veuillez sélectionner 2 invités pour effectuer l&#39;échange&quot;</span><span class="p">)</span>
                        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;table_assigment&#39;</span><span class="p">,</span> <span class="n">mariage</span><span class="o">=</span><span class="n">mariage</span><span class="p">,</span> <span class="n">statut</span><span class="o">=</span><span class="n">statut</span><span class="p">,</span> <span class="n">ident</span><span class="o">=</span><span class="n">ident</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span> 
                            <span class="n">player_1</span> <span class="o">=</span> <span class="n">Player</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Player</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">id_1</span><span class="p">)</span>
                        <span class="k">except</span> <span class="n">DoesNotExist</span><span class="p">:</span> 
                            <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;L&#39;une des deux personnes sélectionnées n&#39;est pas invitée à ce mariage.&quot;</span><span class="p">)</span>
                            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;orga.seating_plan&#39;</span><span class="p">,</span> <span class="n">mariage</span><span class="o">=</span><span class="n">mariage</span><span class="p">,</span> <span class="n">statut</span><span class="o">=</span><span class="n">statut</span><span class="p">,</span> <span class="n">ident</span><span class="o">=</span><span class="n">ident</span><span class="p">))</span>
                        <span class="k">try</span><span class="p">:</span> 
                            <span class="n">player_2</span> <span class="o">=</span> <span class="n">Player</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Player</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">id_2</span><span class="p">)</span>
                        <span class="k">except</span> <span class="n">DoesNotExist</span><span class="p">:</span> 
                            <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;L&#39;une des deux personnes sélectionnées n&#39;est pas invitée à ce mariage.&quot;</span><span class="p">)</span>
                            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;orga.seating_plan&#39;</span><span class="p">,</span> <span class="n">mariage</span><span class="o">=</span><span class="n">mariage</span><span class="p">,</span> <span class="n">statut</span><span class="o">=</span><span class="n">statut</span><span class="p">,</span> <span class="n">ident</span><span class="o">=</span><span class="n">ident</span><span class="p">))</span>
                    
                        <span class="n">table_1</span> <span class="o">=</span> <span class="n">player_1</span><span class="o">.</span><span class="n">table</span>
                        <span class="n">table_2</span> <span class="o">=</span> <span class="n">player_2</span><span class="o">.</span><span class="n">table</span>
                        <span class="n">player_1</span><span class="o">.</span><span class="n">table</span> <span class="o">=</span> <span class="n">table_2</span>
                        <span class="n">player_1</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
                        <span class="n">player_2</span><span class="o">.</span><span class="n">table</span> <span class="o">=</span> <span class="n">table_1</span>
                        <span class="n">player_2</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
                        <span class="n">new_table_assignement</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="n">query</span> <span class="o">=</span> <span class="n">Player</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">Player</span><span class="o">.</span><span class="n">mariage</span> <span class="o">==</span> <span class="n">mariage</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Player</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">is_null</span><span class="p">(</span><span class="kc">False</span><span class="p">)))</span>
                        <span class="k">for</span> <span class="n">player</span> <span class="ow">in</span> <span class="n">query</span><span class="p">:</span>
                            <span class="n">new_table_assignement</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">player</span><span class="o">.</span><span class="n">color</span><span class="p">(),</span><span class="n">player</span><span class="o">.</span><span class="n">table</span><span class="p">])</span>
                        <span class="n">couple</span> <span class="o">=</span> <span class="n">Player</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">Player</span><span class="o">.</span><span class="n">mariage</span> <span class="o">==</span> <span class="n">mariage</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Player</span><span class="o">.</span><span class="n">couple_situation</span> <span class="o">==</span> <span class="mi">1</span><span class="p">))</span>
                        <span class="n">nb_couple</span> <span class="o">=</span> <span class="n">couple</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
                        <span class="n">nb_couple_side_by_side</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="k">for</span> <span class="n">player</span> <span class="ow">in</span> <span class="n">couple</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">player</span><span class="o">.</span><span class="n">same_table</span><span class="p">(</span><span class="n">player</span><span class="o">.</span><span class="n">partner_name</span><span class="p">):</span>
                                <span class="n">nb_couple_side_by_side</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;Les deux invités ont bien été échangés.&quot;</span><span class="p">)</span>
                        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;orga_table_assigment.html&quot;</span><span class="p">,</span> <span class="n">statut</span><span class="o">=</span><span class="n">statut</span><span class="p">,</span> <span class="n">ident</span><span class="o">=</span><span class="n">ident</span><span class="p">,</span> <span class="n">mariage</span><span class="o">=</span><span class="n">mariage</span><span class="p">,</span><span class="n">seating_plan_bool</span><span class="o">=</span><span class="n">seating_plan_bool</span><span class="p">,</span> <span class="n">table_assignement</span><span class="o">=</span><span class="n">new_table_assignement</span><span class="p">,</span><span class="n">nb_table</span><span class="o">=</span><span class="n">nb_table</span><span class="p">,</span> <span class="n">nb_guest</span><span class="o">=</span><span class="n">nb_guest</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">,</span> <span class="n">nb_couple_side_by_side</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">nb_couple_side_by_side</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">nb_couple</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">nb_couple</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">nb_people_side_fav</span><span class="o">=</span><span class="n">nb_people_side_fav</span><span class="p">,</span> <span class="n">messages</span><span class="o">=</span><span class="n">get_flashed_messages</span><span class="p">()</span> <span class="p">)</span>

        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;orga_table_assigment.html&quot;</span><span class="p">,</span> <span class="n">statut</span><span class="o">=</span><span class="n">statut</span><span class="p">,</span> <span class="n">ident</span><span class="o">=</span><span class="n">ident</span><span class="p">,</span> <span class="n">mariage</span><span class="o">=</span><span class="n">mariage</span><span class="p">,</span> <span class="n">seating_plan_bool</span><span class="o">=</span><span class="n">seating_plan_bool</span>  <span class="p">,</span> <span class="n">table_assignement</span><span class="o">=</span><span class="n">table_assignement</span><span class="p">,</span><span class="n">nb_table</span><span class="o">=</span><span class="n">nb_table</span><span class="p">,</span> <span class="n">nb_guest</span><span class="o">=</span><span class="n">nb_guest</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">,</span> <span class="n">nb_couple_side_by_side</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">nb_couple_side_by_side</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">nb_couple</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">nb_couple</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">nb_people_side_fav</span><span class="o">=</span><span class="n">nb_people_side_fav</span><span class="p">,</span> <span class="n">messages</span><span class="o">=</span><span class="n">get_flashed_messages</span><span class="p">()</span> <span class="p">)</span>
    <span class="k">return</span> <span class="n">wrapper</span><span class="p">()</span></div>
    
<div class="viewcode-block" id="orga_info"><a class="viewcode-back" href="../Orga_route.html#Orga_route.orga_info">[docs]</a><span class="nd">@bp</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/orga_info/&lt;statut&gt;/&lt;mariage&gt;/&lt;ident&gt;&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">orga_info</span><span class="p">(</span><span class="n">statut</span><span class="p">,</span> <span class="n">mariage</span><span class="p">,</span> <span class="n">ident</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The function &#39;orga_info&#39; handles the back-end of &#39;orga_info.html&#39; page, meaning the page where an organizer can see </span>
<span class="sd">    the informations of his wedding.</span>

<span class="sd">    :param statut: statut of the user</span>
<span class="sd">    :type statut: str</span>
<span class="sd">    :param mariage: name of the mariage of the guest accessing to its personal profile</span>
<span class="sd">    :type mariage: str</span>
<span class="sd">    :param ident: id of the user</span>
<span class="sd">    :type ident: int</span>

<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="nd">@orga_login_required_id</span><span class="p">(</span><span class="n">ident</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">():</span>
        <span class="n">table_capa_nb</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">try</span><span class="p">:</span> 
            <span class="n">orga</span> <span class="o">=</span> <span class="n">Orga</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="n">Orga</span><span class="o">.</span><span class="n">mariage</span> <span class="o">==</span> <span class="n">mariage</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Orga</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">ident</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">DoesNotExist</span><span class="p">:</span>
            <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;Vous n&#39;êtes pas organisateur de ce mariage. Veuillez vous reconnecter&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s2">&quot;logout&quot;</span><span class="p">,</span> <span class="n">statut</span><span class="o">=</span><span class="n">statut</span><span class="p">,</span> <span class="n">ident</span><span class="o">=</span><span class="n">ident</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">Tables</span><span class="o">.</span><span class="n">is_empty</span><span class="p">(</span><span class="n">Tables</span><span class="p">,</span> <span class="n">mariage</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;orga_info.html&quot;</span><span class="p">,</span> <span class="n">mariage</span><span class="o">=</span><span class="n">mariage</span><span class="p">,</span> <span class="n">ident</span><span class="o">=</span><span class="n">ident</span><span class="p">,</span> <span class="n">statut</span><span class="o">=</span><span class="n">statut</span><span class="p">,</span> <span class="n">groom_full_name</span> <span class="o">=</span> <span class="n">orga</span><span class="o">.</span><span class="n">groom_full_name</span><span class="p">(),</span> <span class="n">bride_full_name</span> <span class="o">=</span> <span class="n">orga</span><span class="o">.</span><span class="n">bride_full_name</span><span class="p">(),</span><span class="n">table_capa_nb</span><span class="o">=</span><span class="n">table_capa_nb</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">orga</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">surname</span> <span class="o">=</span> <span class="n">orga</span><span class="o">.</span><span class="n">surname</span> <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span> 
            <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">Tables</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Tables</span><span class="o">.</span><span class="n">mariage</span> <span class="o">==</span> <span class="n">mariage</span><span class="p">):</span>
                <span class="n">table_capa_nb</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">table</span><span class="o">.</span><span class="n">capacity</span><span class="p">,</span> <span class="n">table</span><span class="o">.</span><span class="n">number</span><span class="p">])</span>
            <span class="n">nb_table_diff</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">table_capa_nb</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;orga_info.html&quot;</span><span class="p">,</span> <span class="n">mariage</span><span class="o">=</span><span class="n">mariage</span><span class="p">,</span> <span class="n">ident</span><span class="o">=</span><span class="n">ident</span><span class="p">,</span> <span class="n">statut</span><span class="o">=</span><span class="n">statut</span><span class="p">,</span> <span class="n">groom_full_name</span> <span class="o">=</span> <span class="n">orga</span><span class="o">.</span><span class="n">groom_full_name</span><span class="p">(),</span> <span class="n">bride_full_name</span> <span class="o">=</span> <span class="n">orga</span><span class="o">.</span><span class="n">bride_full_name</span><span class="p">(),</span><span class="n">table_capa_nb</span><span class="o">=</span><span class="n">table_capa_nb</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">orga</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">surname</span><span class="o">=</span><span class="n">orga</span><span class="o">.</span><span class="n">surname</span><span class="p">,</span> <span class="n">nb_table_diff</span><span class="o">=</span><span class="n">nb_table_diff</span><span class="p">,</span> <span class="n">messages</span><span class="o">=</span><span class="n">get_flashed_messages</span><span class="p">()</span> <span class="p">)</span>
    <span class="k">return</span> <span class="n">wrapper</span><span class="p">()</span></div>


   <span class="c1">### il faudrait permettre aux gens de changer leur info </span>
   <span class="c1">## juste un truc: on peut utiliser form.field.data = qqch pour préremplir le formlaire (comme ca il a pas tout a reremplir)</span>

   <span class="c1"># une petite chose c&#39;est le changement du nom du mariage : si un orga veut changer le nom de son mariage, il faut changer le nom </span>
   <span class="c1"># du mariage pour tout le invité, tout les player, toutes les tables... donc gros bordel mais ca se tente </span>


<div class="viewcode-block" id="orga_change_info"><a class="viewcode-back" href="../Orga_route.html#Orga_route.orga_change_info">[docs]</a><span class="nd">@bp</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/orga_change_info/&lt;statut&gt;/&lt;mariage&gt;/&lt;ident&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;get&#39;</span><span class="p">,</span> <span class="s1">&#39;post&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">orga_change_info</span><span class="p">(</span><span class="n">statut</span><span class="p">,</span> <span class="n">mariage</span><span class="p">,</span> <span class="n">ident</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The function &#39;orga_info&#39; handles the back-end of &#39;orga_info.html&#39; page, meaning the page where an organizer can </span>
<span class="sd">    see the informations of his wedding.</span>

<span class="sd">    :param statut: statut of the user</span>
<span class="sd">    :type statut: str</span>
<span class="sd">    :param mariage: name of the mariage of the guest accessing to its personal profile</span>
<span class="sd">    :type mariage: str</span>
<span class="sd">    :param ident: id of the user</span>
<span class="sd">    :type ident: int</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@orga_login_required_id</span><span class="p">(</span><span class="n">ident</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">():</span>
        <span class="k">try</span><span class="p">:</span> 
            <span class="n">orga</span> <span class="o">=</span> <span class="n">Orga</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="n">Orga</span><span class="o">.</span><span class="n">mariage</span> <span class="o">==</span> <span class="n">mariage</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Orga</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">ident</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">DoesNotExist</span><span class="p">:</span>
            <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;Vous n&#39;êtes pas organisateur de ce mariage. Veuillez vous reconnecter&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s2">&quot;logout&quot;</span><span class="p">,</span> <span class="n">statut</span><span class="o">=</span><span class="n">statut</span><span class="p">,</span> <span class="n">ident</span><span class="o">=</span><span class="n">ident</span><span class="p">))</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span> <span class="p">:</span> <span class="n">orga</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="s1">&#39;surname&#39;</span> <span class="p">:</span> <span class="n">orga</span><span class="o">.</span><span class="n">surname</span><span class="p">,</span>
            <span class="s1">&#39;email&#39;</span> <span class="p">:</span><span class="n">orga</span><span class="o">.</span><span class="n">email</span><span class="p">,</span> 
            <span class="s1">&#39;mariage&#39;</span> <span class="p">:</span><span class="n">mariage</span><span class="p">,</span> 
            <span class="s1">&#39;groom_name&#39;</span><span class="p">:</span> <span class="n">orga</span><span class="o">.</span><span class="n">groom_name</span><span class="p">,</span>
            <span class="s1">&#39;groom_surname&#39;</span><span class="p">:</span> <span class="n">orga</span><span class="o">.</span><span class="n">groom_surname</span><span class="p">,</span> 
            <span class="s1">&#39;bride_name&#39;</span><span class="p">:</span><span class="n">orga</span><span class="o">.</span><span class="n">bride_name</span><span class="p">,</span>
            <span class="s1">&#39;bride_surname&#39;</span><span class="p">:</span> <span class="n">orga</span><span class="o">.</span><span class="n">bride_surname</span>
        <span class="p">}</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">orga_register</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="c1">#form = orga_edite_profile(data=data)</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">validate_on_submit</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">check_password_hash</span><span class="p">(</span><span class="n">orga</span><span class="o">.</span><span class="n">password</span><span class="p">,</span> <span class="n">form</span><span class="o">.</span><span class="n">password</span><span class="o">.</span><span class="n">data</span><span class="p">):</span>
                    <span class="n">orga</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">data</span>
                    <span class="n">orga</span><span class="o">.</span><span class="n">surname</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">surname</span><span class="o">.</span><span class="n">data</span>
                    <span class="n">orga</span><span class="o">.</span><span class="n">mariage</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">mariage</span><span class="o">.</span><span class="n">data</span>
                    <span class="n">orga</span><span class="o">.</span><span class="n">groom_name</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">groom_name</span><span class="o">.</span><span class="n">data</span>
                    <span class="n">orga</span><span class="o">.</span><span class="n">groom_surname</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">groom_surname</span><span class="o">.</span><span class="n">data</span>
                    <span class="n">orga</span><span class="o">.</span><span class="n">bride_name</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">bride_name</span><span class="o">.</span><span class="n">data</span>
                    <span class="n">orga</span><span class="o">.</span><span class="n">bride_surname</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">bride_surname</span><span class="o">.</span><span class="n">data</span>
                    <span class="n">orga</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
                    <span class="n">Guest</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">mariage</span><span class="o">=</span><span class="n">orga</span><span class="o">.</span><span class="n">mariage</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Guest</span><span class="o">.</span><span class="n">mariage</span> <span class="o">==</span> <span class="n">mariage</span><span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
                    <span class="n">Player</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">mariage</span><span class="o">=</span><span class="n">orga</span><span class="o">.</span><span class="n">mariage</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Player</span><span class="o">.</span><span class="n">mariage</span> <span class="o">==</span> <span class="n">mariage</span><span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
                    <span class="n">Tables</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">mariage</span> <span class="o">=</span><span class="n">orga</span><span class="o">.</span><span class="n">mariage</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Tables</span><span class="o">.</span><span class="n">mariage</span> <span class="o">==</span><span class="n">mariage</span><span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
                    <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;Vos données ont bien été modifiées&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;orga.orga_info&#39;</span><span class="p">,</span> <span class="n">mariage</span> <span class="o">=</span> <span class="n">orga</span><span class="o">.</span><span class="n">mariage</span><span class="p">,</span> <span class="n">statut</span> <span class="o">=</span><span class="n">statut</span><span class="p">,</span> <span class="n">ident</span><span class="o">=</span><span class="n">ident</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span> 
                    <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;Mot de passe incorrect, veuillez réessayer&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s2">&quot;orga.orga_change_info&quot;</span><span class="p">,</span> <span class="n">mariage</span><span class="o">=</span><span class="n">mariage</span><span class="p">,</span> <span class="n">statut</span><span class="o">=</span><span class="n">statut</span><span class="p">,</span> <span class="n">ident</span><span class="o">=</span><span class="n">ident</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span> 
                <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;Les informations renseignées sont mauvaises&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s2">&quot;orga.orga_change_info&quot;</span><span class="p">,</span> <span class="n">mariage</span><span class="o">=</span><span class="n">mariage</span><span class="p">,</span> <span class="n">statut</span><span class="o">=</span><span class="n">statut</span><span class="p">,</span> <span class="n">ident</span><span class="o">=</span><span class="n">ident</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;orga_change_info.html&quot;</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">,</span> <span class="n">mariage</span><span class="o">=</span><span class="n">mariage</span><span class="p">,</span> <span class="n">statut</span><span class="o">=</span><span class="n">statut</span><span class="p">,</span> <span class="n">ident</span><span class="o">=</span><span class="n">ident</span><span class="p">,</span> <span class="n">messages</span><span class="o">=</span><span class="n">get_flashed_messages</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">wrapper</span><span class="p">()</span></div>


<span class="n">db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Lucas Sautier - Pierre-Louis Le Goff - Nicolas Corvol - Garance Gérard.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>